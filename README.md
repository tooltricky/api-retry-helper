# API Retry Helper - Chrome 浏览器插件

这是一个 Chrome 浏览器插件，用于自动重试 `/api/instance/create` API 请求，直到请求成功。

> 注意事项：本项目专门用于仙宫云抢卡

## 功能特点

- 🔍 自动检测页面中的 `/api/instance/create` POST 请求
- 📋 完整复制请求头和请求体
- 🔄 一键自动重试，直到接口返回成功（code: 200）
- ⏹️ 随时停止重试过程
- 📊 实时显示重试次数和最新响应
- ⚡ 无延迟连续重试（最快速度）

## 安装步骤

### 1. 准备插件文件

确保你有以下文件：
- `manifest.json`
- `background.js`
- `popup.html`
- `popup.js`
- `styles.css`

### 2. 创建图标文件（可选）

在插件目录中创建三个图标文件：
- `icon16.png` (16x16 像素)
- `icon48.png` (48x48 像素)
- `icon128.png` (128x128 像素)

如果没有图标，可以先注释掉 `manifest.json` 中的 icons 部分。

### 3. 在 Chrome 中加载插件

1. 打开 Chrome 浏览器
2. 在地址栏输入 `chrome://extensions/` 并回车
3. 在右上角打开「开发者模式」
4. 点击「加载已解压的扩展程序」
5. 选择包含插件文件的文件夹
6. 插件安装成功！

## 使用方法

### 1. 检测请求

1. 访问包含 `/api/instance/create` 请求的网页
2. 触发一次 API 请求（例如点击创建实例按钮）
3. 插件会自动捕获这个请求的所有信息

### 2. 开始重试

1. 点击浏览器右上角的插件图标
2. 插件弹窗会显示检测到的请求信息
3. 点击「开始重试」按钮
4. 插件会立即开始重试请求，并显示：
   - 当前重试次数
   - 最新的响应内容

### 3. 停止重试

- 如果需要停止，点击「停止」按钮
- 收到成功响应（code: 200）时会自动停止

## 响应判断逻辑

插件会判断 API 响应的 `code` 字段：

- **成功**：`{"code": 200, "msg": "...", "status": "success", "success": true}`
  - 停止重试，显示成功消息

- **失败**：`{"code": 1000, "msg": "可用GPU不足", "status": "error"}`
  - 继续重试

## 技术说明

- 使用 Chrome Extension Manifest V3
- 使用 `webRequest` API 拦截网络请求
- 使用 `fetch` API 重放请求
- 所有重试没有延迟（连续发送）

## 注意事项

1. ⚠️ **请谨慎使用**：连续无延迟的请求可能对服务器造成压力
2. 🔒 **权限要求**：插件需要访问所有网站的权限以拦截请求
3. 🌐 **同源策略**：如果遇到 CORS 错误，可能需要在服务器端配置允许跨域
4. 📝 **请求头**：某些浏览器自动添加的请求头（如 Host、Content-Length）会被过滤

## 故障排查

### 插件未检测到请求

- 确保请求 URL 包含 `/api/instance/create`
- 打开浏览器开发者工具（F12）> Network 标签，确认请求确实发出
- 检查插件是否已正确安装并启用

### 重试时出现错误

- 检查 Console 中的错误信息
- 确认原始请求的认证信息（Cookie、Token）是否有效
- 某些请求可能有时效性限制

### 无法安装插件

- 确保所有文件都在同一个文件夹中
- 检查 `manifest.json` 格式是否正确
- 如果没有图标文件，先删除 manifest.json 中的 icons 配置

## 开发者信息

- 版本：1.0.0
- Manifest 版本：V3
- 支持的浏览器：Chrome、Edge（基于 Chromium）

## 许可证

GPL License

---

如有问题或建议，请提交 Issue。
